<!--saisi facture-->
<style xmlns="http://www.w3.org/1999/html">
  b {
    color: black;
  }
</style>
<!---->

<div class="card">
  <div class="card-header card-header-icon">
    <div class="card-icon" style="background-color:rgba(17, 17, 227, 0.88)">
      <i class="material-icons">search</i>
    </div>
    <h2 class="text-center" 
    style="background-color:whitesmoke; color: black; pading: 2px; width: 40%;">Facture par
      saisie</h2>
  </div>
  <div class="card-body">

    <form>
      <div class="row">

        <div class="col-md-3 form-group" style="margin-top: -20px;">
          <!--*ngIf="agree" -->
<!--          <mat-form-field>-->
            <label for="Prestataires"><b>Prestataires</b> </label>
            <mat-select name="Prestataires" class="form-control" id="Prestataires" formControlName="Prestataires">
              <mat-option *ngFor="let prest of listPrestataire" [value]="prest.code_prestataire"
                (click)="getnomprestataire(prest)">
                {{ prest.nom_prestataire }}
              </mat-option>
            </mat-select>
<!--          </mat-form-field>-->
        </div>

        <div class="col-md-3 form-group" style="margin-top: -20px;">

          <label for="numerofacture"><b>Numero Facture</b></label><br />

          <input type="text" class="form-control" id="numerofacture" name="numerofacture" [(ngModel)]="numerofacture">
        </div>
        <div class="form-group  col-md-3" style="margin-top: -20px;">
          <label for="date_facture"><b>Date Facture</b>
          </label>
          <input type="date" class="form-control" id="date_facture" name="date_facture" placeholder="date_facture"
            [(ngModel)]="date_facture"   >
<!--          [disabled]="true"-->
        </div>

        <div class="col-md-3" style="margin-top: -20px;">
          <!-- <legend>date Facture</legend> -->
          <label for="date_facture"><b>Date Reception</b>
          </label>
<!--          <mat-form-field>-->
<!--          <input matInput [matDatepicker]="picker" placeholder="date reception" id="reception" name="reception" [(ngModel)]="reception" (click)="picker.open()">-->
<!--          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>-->
<!--          <mat-datepicker #picker startView="year"></mat-datepicker>-->
            <input type="date" class="form-control" id="reception" name="reception" placeholder=" date reception"
                   [(ngModel)]="reception" >
<!--          </mat-form-field>-->



      </div>
        <div class="col-md-8 form-group">
          <label>Observation</label>
          <textarea cols="5" rows="5" style="background-color:rgb(243, 237, 237);" type="text"
                    class="form-control" id="observation" [(ngModel)]="observation" name="observation"></textarea>
        </div>
      </div>
    </form>
  </div>
</div>


        <div class="card" *ngIf="date_facture && reception  && numerofacture && prestataire_choisi" style="width:70%">
            <div class="card-header card-header-icon">
<!--                <div class="card-icon" style="background-color:rgba(17, 17, 227, 0.88)">-->
<!--                    <i class="material-icons">search</i>-->
<!--                </div>-->
                <h2 class="text-center"
                    style="background-color:whitesmoke; color: black; pading: 2px; width: 60%;">Rechercher Participant</h2>
            </div>
            <div class="card-body">
        <div class="form-group  col-md-3" style="margin-top: -20px; ">
            <label for="Matricule"><b>Matricule</b> </label>
            <input type="text" name="matricule" class="form-control" style="width: 120%" id="matricule" [(ngModel)]="matricule" placeholder="Saisissez Matricule">
        </div>
      
      <div class= "justify-content-center">
        <button mat-raised-button class="btn btn-raised btn-round btn-success" (click)="findByMatricules()">recherche
        </button>

       </div>
            </div>
        </div>




<!--fin recherche-->
<div class="" *ngIf="message">

  <div class="">

    <!---->
    <div class="card">
      <div class="card-header card-header-icon">
        <div class="card-icon" style="background-color:rgba(17, 17, 227, 0.88)">
          <i class="material-icons">text_snippet</i>
        </div>
        <h2 class="text-center"
         style="background-color:whitesmoke; color: black; pading: 2px; width: 40%;">Facture Prestation</h2>
    </div>
      <div class="card-body">

        <form [formGroup]="factureForm">

          <div class="row">


            <div class="col-md-4 form-group" style="margin-top: -20px;">
              <mat-form-field>
                <label for="Prestataires"><b>Choisir une Prestation</b> </label>
                <mat-select  name="Prestation"
                  class="form-control" id="Prestation" [(ngModel)]="Prestation">
                  <mat-option *ngFor="let pret of listPrestation" [value]="pret.code_prestation" (click)="getnom(pret)">
                    {{ pret.libelle }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

          </div>
          <hr>
          <div class="row" style="color:black;">


            <div class="col-md-3 form-group">
              <label for="Matricule"><b>Matricule</b></label><br />
                 <b> {{message.matricule}}</b>
              <!-- <input type="number" class="form-control" id="matricule" formControlName="Matricule"> -->
            </div>
            <div class="col-md-3 form-group">
              <label for="participant"> <b>participant</b></label><br />
              <b>{{message.nom}} {{message.prenom}}</b>
              <!-- <input type="text" class="form-control" id="Montant" formControlName="participant"> -->
            </div>
            <div class="col-md-3 form-group">
              <label for="prestation"><b>prestation</b></label><br />
              <b>{{prestation_choisi}}</b>
              <!-- <input type="text" class="form-control" id="prestation" formControlName="prestation"> -->
            </div>
            <div class="col-md-3 form-group">
              <label for="Prestataires "><b>Prestataires</b></label><br />
              <b>{{prestataire_choisi}}</b>
              <!-- <input type="number" class="form-control" id="matricule" formControlName="Matricule"> -->
            </div>


          </div>
          <hr>
          <div class="row">

            <div class="col-md-3 form-group">
              <label for="Montant"><b>Montant Facture</b></label>

              <input type="text" class="form-control" id="Montant" formControlName="Montant">
            </div>
            <div class="col-md-3 form-group">
              <label for="Code_acte"><b>Code acte</b></label><br />

              <input type="number" class="form-control" id="Code_acte" formControlName="Code_acte">
            </div>

            <div class="col-md-3 form-group" *ngIf="!this.forfait">
              <label for="Taux_ipm"><b>Taux ipm</b></label><br />
              {{taux_ipm}}
              <!-- <input type="number" class="form-control" id="Taux_ipm" formControlName="Taux_ipm"> -->
            </div>
            <div class="col-md-3 form-group" *ngIf="this.forfait">
              <label ><b>Montant Maximum</b></label><br />
              {{montant_forfait}}
              <!-- <input type="number" class="form-control" id="Taux_ipm" formControlName="Taux_ipm"> -->
            </div>

          </div>
          <hr>
          <div class="row">




            <!-- <div class="form-group  col-md-3">
                <label for="date_saisie">Date de saisie</label>
                <input type="date" class="form-control" id="date_saisie" formControlName="date_saisie">
              </div> -->

            <div class="form-group  col-md-3">
              <label for="date_prestation"><b>date de prestation</b></label>
              <input type="date" class="form-control" id="date_prestation" formControlName="date_prestation">
            </div>


          </div>



          <div class="modal-footer justify-content-center">
            <button mat-raised-button class="btn btn-raised btn-round btn-success" (click)="addDetails()">Ajouter
              facture </button>

          </div>

          <div>
          </div>

        </form>

      </div>
    </div>
  </div>
</div>
<!--liste facture-->
<div class="col-md-12"  >
  <div class="card" *ngIf="message && panier">
    <div class="card-header card-header-icon">
      <div class="card-icon" style="background-color:rgba(17, 17, 227, 0.88)">
        <i class="material-icons">list</i>

      </div>
      <h2 class="text-center" 
      style="background-color:whitesmoke; color: black; pading: 2px; width: 40%;">liste Prestation
      </h2>
    </div>
    <div class="card-body">

      <table class="table table-hover table-bordered">

        <thead style="font-weight:bold;">

          <th cope="col"> Matricule</th>
          <th cope="col">Participant</th>
          <th cope="col">Prestation</th>
          <!-- <th cope="col">Code Prestation</th> -->
          <th cope="col">TauxIpm</th>
          <th cope="col">MontantFacture</th>
          <th cope="col">ChargeIpm</th>
          <th cope="col">ChargeAgent</th>
          <th cope="col">Date</th>
          <th cope="col">Action</th>

        </thead>
        <tbody>
          <tr *ngFor="let element of panier; let i=index">
            <td><b>{{element.matricule}}</b></td>
            <td><b>{{element.ipm_employe?.prenom}}</b></td>
            <!-- <td><b>{{prestation_choisi}}</b></td> -->
            <td>{{element.ipm_prestation?.libelle}}</td>
            <td><b>{{element.taux_ipm}}</b></td>
            <td><b>{{element.montant_facture}}</b></td>
            <td><b>{{element.part_ipm}}</b></td>
            <td><b>{{element.part_patient}}</b></td>
            <td><b>{{element.datePrestation | date: 'dd/MM/yyyy'}}</b></td>
            <td class="td_actions">
              <i class="material-icons" class="btn btn-danger" (click)=deleteDetails(i)><span
                  class="fa fa-trash-o"></span></i>
            </td>
             <td>
              <button class="btn btn-info btn-block" 
             data-toggle="modal" data-target="#noticeModal" (click)="editDetails(i)"><span class="fa fa-edit fa-lg"></span>
              </button></td> 


          </tr>
        </tbody>
        <tfoot style="font-weight:bold;">
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td>
              <h4>TOTAL</h4>
            </td>
            <td>{{total}}</td>
            <td>{{totalChargeIpm}}</td>
            <td>{{totalChargeAgent}}</td>
            <td></td>
            <td></td>
            <td></td>

          </tr>
        </tfoot>

      </table>
      <div class="modal-footer justify-content-center">
        <button class="btn btn-raised btn-round btn-success" [disabled]="validerFact" (click)="ajoutFacture()">Valider facture
        </button>
      </div>
    </div>

  </div>
</div>
<!--fin liste-->


<!-- Partie Modification -->
 <div class="modal fade" id="noticeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Modification du facture Prestataire</h4>
        <button mat-button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          <i class="material-icons">clear</i>
        </button>
      </div>
      <div class="modal-body">

        <form #userForme="ngForm">
          <div class="row">
            <div class="col-md-12">
              <label for="Montant">Montant Facture</label>

              <input type="number" class="form-control" id="montant_facture" formControlName="dataa.montant_facture">
              <mat-form-field class="example-full-width">

                <input matInput type="text" placeholder="nom prestataire" id="nom_prestataire" name="nom_prestataire">
              </mat-form-field>
            </div>
            <div class="col-md-12">
              <mat-form-field class="example-full-width">
                <input matInput type="text" placeholder="adresse" id="adresse_prestataire">
              </mat-form-field>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 form-group">
              <mat-form-field>
                <mat-select placeholder="Prestataire" name="listTypePrestataire" [(ngModel)]="code_presta">
                  <!-- <mat-option *ngFor="let prest of cur" [value]="prest.id_type_prestataire">
                    {{ prest.nom_type_prestaire }}
                  </mat-option> -->
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <mat-form-field class="example-full-width">
                <input matInput type="text" placeholder="Telephone" id="telephone" name="telephone">
              </mat-form-field>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <mat-form-field class="example-full-width">
                <input matInput type="text" placeholder="Code Categorie" id="code_categorie_pretataire"
                  name="code_categorie_pretataire">
              </mat-form-field>
            </div>
          </div>



        </form>


        <div class="modal-footer">
          <button mat-raised-button type="submit" class="btn btn-fill btn-success btn-round"
            data-dismiss="modal">modifier</button>
        </div>

      </div>

    </div>
  </div>
</div> 